<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plataformer Tileset Demo</title>
  <style>
    body { 
      background: #1a1a1a; 
      color: #fff; 
      text-align: center; 
      font-family: Arial, sans-serif; 
      margin: 0;
      padding: 0;
    }
    #hud { 
      margin: 10px auto; 
      width: 640px; 
      display: flex; 
      justify-content: space-between; 
      font-size: 18px;
    }
    canvas { 
      background: linear-gradient(to bottom, #87ceeb, #4682b4); 
      border: 4px solid #00ffe7; 
      border-radius: 12px; 
      box-shadow: 0 0 20px rgba(0, 255, 231, 0.5);
    }
    p { 
      margin: 10px 0; 
      font-size: 16px; 
    }
    #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
      display: none;
    }
    #game-over h2 {
      margin: 0 0 10px;
      color: #ff4444;
    }
    #game-over button {
      padding: 10px 20px;
      font-size: 16px;
      background: #00ffe7;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #game-over button:hover {
      background: #00d4c2;
    }
  </style>
</head>
<body>
  <h1>Plataformer Tileset Demo</h1>
  <div id="hud">
    <span id="lives">❤️❤️❤️</span>
    <span id="coins">Moedas: 0</span>
    <span id="level">Fase: 1</span>
  </div>
  <canvas id="game" width="640" height="384"></canvas>
  <div id="game-over">
    <h2>Game Over!</h2>
    <p>Você perdeu todas as suas vidas.</p>
    <button onclick="restartGame()">Jogar Novamente</button>
  </div>
  <p>Setas: mover | A: pular</p>
  <script>
    // --- Sprites (usando base64 para evitar falhas de carregamento) ---
    const tileSize = 32;
    const playerSprite = new Image();
    const enemySprite = new Image();
    const coinSprite = new Image();

    // Imagens base64 como fallback (simples quadrados coloridos para teste)
    playerSprite.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABYSURBVFhH7dNBCgAgCETR/v8v9iWjB0yTQKAAiA+AAwDHk5W1jW3bYbPZbDYbzX8B/ZW1jW3btm3btm3btm3btm3btu3btm3btm3btm3btm3btm3btu3btm3b9g1sM0eN7mUAAAAASUVORK5CYII=';
    enemySprite.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABYSURBVFhH7dNBDcAwAASw/P8/2ZcAHRiAAiA+AA4AHG9W1ja2bYe1bYfNZrPZrDYbzX8B/ZW1jW3btm3btm3btm3btm3btu3btm3btm3btm3btm3btm3btu3btm3b9g1sM0eN7mUAAAAASUVORK5CYII=';
    coinSprite.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABYSURBVDhPY2AYBaNgFAMDA4MhDIyMjAyMGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgY5QAC0y5jGAAAAAElFTkSuQmCC';

    // --- Mapas (0: vazio, 1: chão, 2: água, 3: espinho, 4: moeda, 5: inimigo) ---
    const maps = [
      [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      ],
      [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      ]
    ];

    // --- Estado do jogo ---
    let level = 0, lives = 3, coins = 0;
    let player = { x: 2, y: 7, vx: 0, vy: 0, onGround: false, w: 28, h: 32 };
    let enemies = [];
    let keys = {};
    let gameOver = false;

    // --- Canvas ---
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const gameOverScreen = document.getElementById('game-over');

    // --- Controles ---
    document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    // --- Funções auxiliares ---
    function countCoins() {
      let coinCount = 0;
      for (let y = 0; y < 10; y++) {
        for (let x = 0; x < 20; x++) {
          if (maps[level][y][x] === 4) coinCount++;
        }
      }
      return coinCount;
    }

    function loadEnemies() {
      enemies = [];
      for (let y = 0; y < 10; y++) {
        for (let x = 0; x < 20; x++) {
          if (maps[level][y][x] === 5) {
            enemies.push({ x, y, dir: 1, w: 28, h: 32 });
            maps[level][y][x] = 0;
          }
        }
      }
    }

    function restartGame() {
      level = 0;
      lives = 3;
      coins = 0;
      player = { x: 2, y: 7, vx: 0, vy: 0, onGround: false, w: 28, h: 32 };
      gameOver = false;
      gameOverScreen.style.display = 'none';
      canvas.style.display = 'block';
      maps[0] = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      ];
      maps[1] = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      ];
      loadEnemies();
      loop();
    }

    // --- Loop ---
    function update() {
      if (gameOver) return;

      // Movimento player
      if (keys['arrowleft']) player.vx = -2.5;
      else if (keys['arrowright']) player.vx = 2.5;
      else player.vx = 0;

      // Pulo
      if (keys['a'] && player.onGround) {
        player.vy = -7;
        player.onGround = false;
      }

      // Gravidade
      player.vy += 0.35;
      let nx = player.x + player.vx / tileSize;
      let ny = player.y + player.vy / tileSize;

      // Colisão com tiles
      player.onGround = false;
      for (let y = 0; y < 10; y++) {
        for (let x = 0; x < 20; x++) {
          let t = maps[level][y][x];
          if (t === 1 || t === 2 || t === 3) {
            let tx = x, ty = y;
            let px = nx * tileSize, py = ny * tileSize;
            let tw = tileSize, th = tileSize;
            if (px + player.w > tx * tw && px < (tx + 1) * tw &&
                py + player.h > ty * th && py < (ty + 1) * th) {
              if (player.vy > 0 && py + player.h > ty * th) {
                ny = ty - player.h / tileSize;
                player.vy = 0;
                player.onGround = true;
              } else if (player.vy < 0 && py < ty * th) {
                ny = ty + 1;
                player.vy = 0;
              }
              if (player.vx > 0 && px + player.w > tx * tw) {
                nx = tx - player.w / tileSize;
                player.vx = 0;
              } else if (player.vx < 0 && px < (tx + 1) * tw) {
                nx = tx + 1;
                player.vx = 0;
              }
              if (t === 2) player.vx *= 0.7; // água
              if (t === 3) {
                lives--;
                player.x = 2;
                player.y = 7;
                player.vx = 0;
                player.vy = 0;
              }
            }
          }
        }
      }
      player.x = nx;
      player.y = ny;

      // Limites
      if (player.x < 0) player.x = 0;
      if (player.x > 19 - player.w / tileSize) player.x = 19 - player.w / tileSize;
      if (player.y > 8) {
        player.x = 2;
        player.y = 7;
        lives--;
        player.vx = 0;
        player.vy = 0;
      }

      // Colisão com moeda
      for (let y = 0; y < 10; y++) {
        for (let x = 0; x < 20; x++) {
          if (maps[level][y][x] === 4) {
            let tx = x * tileSize, ty = y * tileSize;
            if (player.x * tileSize + player.w > tx && player.x * tileSize < tx + tileSize &&
                player.y * tileSize + player.h > ty && player.y * tileSize < ty + tileSize) {
              maps[level][y][x] = 0;
              coins++;
            }
          }
        }
      }

      // Transição de fase
      if (countCoins() === 0) {
        if (level < maps.length - 1) {
          level++;
          player.x = 2;
          player.y = 7;
          player.vx = 0;
          player.vy = 0;
          loadEnemies();
        } else {
          alert("Parabéns! Você venceu todas as fases!");
          restartGame();
        }
      }

      // Inimigos
      enemies.forEach(enemy => {
        enemy.x += 0.03 * enemy.dir;
        if (enemy.x < 1 || enemy.x > 18) enemy.dir *= -1;
        if (Math.abs(player.x - enemy.x) < 0.7 && Math.abs(player.y - enemy.y) < 0.7) {
          player.x = 2;
          player.y = 7;
          player.vx = 0;
          player.vy = 0;
          lives--;
        }
      });

      // Game Over
      if (lives <= 0) {
        gameOver = true;
        gameOverScreen.style.display = 'block';
        canvas.style.display = 'none';
      }

      // HUD
      document.getElementById('lives').textContent = "❤️".repeat(lives);
      document.getElementById('coins').textContent = "Moedas: " + coins;
      document.getElementById('level').textContent = "Fase: " + (level + 1);
    }

    function draw() {
      console.log("Desenhando quadro...");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Tiles
      for (let y = 0; y < 10; y++) {
        for (let x = 0; x < 20; x++) {
          let t = maps[level][y][x];
          if (t === 1) { // chão
            ctx.fillStyle = "#654321";
            ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
            ctx.fillStyle = "rgba(0,0,0,0.2)";
            ctx.fillRect(x * tileSize + 2, y * tileSize + 2, tileSize - 4, tileSize - 4);
          }
          if (t === 2) { // água
            ctx.fillStyle = "#2196f3";
            ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
          }
          if (t === 3) { // espinho
            ctx.fillStyle = "#b71c1c";
            ctx.beginPath();
            ctx.moveTo(x * tileSize, (y + 1) * tileSize);
            ctx.lineTo(x * tileSize + tileSize / 2, y * tileSize);
            ctx.lineTo((x + 1) * tileSize, (y + 1) * tileSize);
            ctx.closePath();
            ctx.fill();
          }
          if (t === 4) { // moeda
            ctx.drawImage(coinSprite, x * tileSize + 8, y * tileSize + 8, 16, 16);
          }
        }
      }
      // Player
      ctx.drawImage(playerSprite, player.x * tileSize, player.y * tileSize, player.w, player.h);
      // Inimigos
      enemies.forEach(enemy => {
        ctx.drawImage(enemySprite, enemy.x * tileSize, enemy.y * tileSize, enemy.w, enemy.h);
      });
    }

    function loop() {
      if (!gameOver) {
        update();
        draw();
        requestAnimationFrame(loop);
      }
    }

    // --- Iniciar ---
    console.log("Iniciando o jogo...");
    loadEnemies();
    loop();
  </script>
</body>
</html>
