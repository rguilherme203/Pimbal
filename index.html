<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Plataformer Tileset Demo</title>
  <style>
    body { background: #222; color: #fff; text-align: center; }
    #hud { margin: 10px auto; width: 640px; display: flex; justify-content: space-between; }
    canvas { background: #222; border: 4px solid #00ffe7; border-radius: 12px; }
  </style>
</head>
<body>
  <h1>Plataformer Tileset Demo</h1>
  <div id="hud">
    <span id="lives">❤️❤️❤️</span>
    <span id="coins">Moedas: 0</span>
    <span id="level">Fase: 1</span>
  </div>
  <canvas id="game" width="640" height="384"></canvas>
  <p>Setas: mover | A: pular</p>
  <script>
    // --- Sprites (use imagens reais para produção) ---
    const tileSize = 32;
    const playerSprite = new Image();
    playerSprite.src = "https://opengameart.org/sites/default/files/hero_0.png";
    const enemySprite = new Image();
    enemySprite.src = "https://opengameart.org/sites/default/files/robot_0.png";
    const coinSprite = new Image();
    coinSprite.src = "https://opengameart.org/sites/default/files/coin_gold.png";

    // --- Mapas (0: vazio, 1: chão, 2: água, 3: espinho, 4: moeda, 5: inimigo) ---
    const maps = [
      [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      ],
      [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      ]
    ];

    // --- Estado do jogo ---
    let level = 0, lives = 3, coins = 0;
    let player = {x: 2, y: 7, vx: 0, vy: 0, onGround: false, w: 28, h: 32};
    let enemy = {x: 10, y: 8, dir: 1, w: 28, h: 32};
    let keys = {};

    // --- Canvas ---
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // --- Controles ---
    document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    // --- Loop ---
    function update() {
      // Movimento player
      if (keys['arrowleft']) player.vx = -2.5;
      else if (keys['arrowright']) player.vx = 2.5;
      else player.vx = 0;

      // Pulo
      if (keys['a'] && player.onGround) {
        player.vy = -7;
        player.onGround = false;
      }

      // Gravidade
      player.vy += 0.35;
      let nx = player.x + player.vx;
      let ny = player.y + player.vy;

      // Colisão com tiles
      player.onGround = false;
      for (let y=0; y<10; y++) for (let x=0; x<20; x++) {
        let t = maps[level][y][x];
        if (t === 1 || t === 2 || t === 3) {
          let tx = x*tileSize, ty = y*tileSize;
          if (nx*tileSize+player.w > tx && nx*tileSize < tx+tileSize &&
              ny*tileSize+player.h > ty && ny*tileSize < ty+tileSize) {
            if (player.vy > 0) { ny = y-1; player.vy = 0; player.onGround = true; }
            if (t === 2) player.vx *= 0.7; // água
            if (t === 3) { lives--; player.x = 2; player.y = 7; }
          }
        }
      }
      player.x += player.vx;
      player.y += player.vy;

      // Limites
      if (player.x < 0) player.x = 0;
      if (player.x > 19) player.x = 19;
      if (player.y > 8) { player.x = 2; player.y = 7; lives--; }

      // Colisão com moeda
      for (let y=0; y<10; y++) for (let x=0; x<20; x++) {
        if (maps[level][y][x] === 4) {
          let tx = x*tileSize, ty = y*tileSize;
          if (player.x*tileSize+player.w > tx && player.x*tileSize < tx+tileSize &&
              player.y*tileSize+player.h > ty && player.y*tileSize < ty+tileSize) {
            maps[level][y][x] = 0;
            coins++;
          }
        }
      }

      // Inimigo simples
      enemy.x += 0.03 * enemy.dir;
      if (enemy.x < 1 || enemy.x > 18) enemy.dir *= -1;
      // Colisão player-inimigo
      if (Math.abs(player.x-enemy.x)<0.7 && Math.abs(player.y-enemy.y)<0.7) {
        player.x = 2; player.y = 7; lives--;
      }

      // HUD
      document.getElementById('lives').textContent = "❤️".repeat(lives);
      document.getElementById('coins').textContent = "Moedas: "+coins;
      document.getElementById('level').textContent = "Fase: "+(level+1);
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // Tiles
      for (let y=0; y<10; y++) for (let x=0; x<20; x++) {
        let t = maps[level][y][x];
        if (t === 1) { // chão
          ctx.fillStyle = "#654321";
          ctx.fillRect(x*tileSize, y*tileSize, tileSize, tileSize);
        }
        if (t === 2) { // água
          ctx.fillStyle = "#2196f3";
          ctx.fillRect(x*tileSize, y*tileSize, tileSize, tileSize);
        }
        if (t === 3) { // espinho
          ctx.fillStyle = "#b71c1c";
          ctx.beginPath();
          ctx.moveTo(x*tileSize, (y+1)*tileSize);
          ctx.lineTo(x*tileSize+tileSize/2, y*tileSize);
          ctx.lineTo((x+1)*tileSize, (y+1)*tileSize);
          ctx.closePath();
          ctx.fill();
        }
        if (t === 4) { // moeda
          ctx.drawImage(coinSprite, x*tileSize+8, y*tileSize+8, 16, 16);
        }
      }
      // Player
      ctx.drawImage(playerSprite, player.x*tileSize, player.y*tileSize, player.w, player.h);
      // Inimigo
      ctx.drawImage(enemySprite, enemy.x*tileSize, enemy.y*tileSize, enemy.w, enemy.h);
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // --- Iniciar ---
    playerSprite.onload = () => loop();
  </script>
</body>
</html>
